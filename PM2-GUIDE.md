# PM2ã§Discord Botã‚’å¸¸æ™‚èµ·å‹•ã•ã›ã‚‹æ–¹æ³•

## ğŸ“‹ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### 1. PM2ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
npm install -g pm2
```

### 2. Botã‚’èµ·å‹•
```bash
npm run pm2:start
```

### 3. ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•æ™‚ã«è‡ªå‹•èµ·å‹•ã‚’è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
```bash
npm run pm2:startup
# è¡¨ç¤ºã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦å®Ÿè¡Œ
```

## ğŸ›ï¸ PM2ã‚³ãƒãƒ³ãƒ‰

### åŸºæœ¬æ“ä½œ
```bash
# Botã‚’èµ·å‹•
npm run pm2:start

# Botã‚’åœæ­¢
npm run pm2:stop

# Botã‚’å†èµ·å‹•
npm run pm2:restart

# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
npm run pm2:status

# ãƒ­ã‚°ã‚’ç¢ºèª
npm run pm2:logs
```

### è©³ç´°ãªPM2ã‚³ãƒãƒ³ãƒ‰
```bash
# ãƒ—ãƒ­ã‚»ã‚¹ä¸€è¦§è¡¨ç¤º
pm2 list

# ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°
pm2 monit

# ãƒ­ã‚°ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º
pm2 logs discord-github-bot --lines 50

# ãƒ—ãƒ­ã‚»ã‚¹è©³ç´°æƒ…å ±
pm2 show discord-github-bot

# è¨­å®šã‚’ãƒªãƒ­ãƒ¼ãƒ‰
pm2 reload ecosystem.config.js

# å…¨ãƒ—ãƒ­ã‚»ã‚¹åœæ­¢
pm2 stop all

# å…¨ãƒ—ãƒ­ã‚»ã‚¹å‰Šé™¤
pm2 delete all
```

## ğŸ“Š ãƒ­ã‚°ç®¡ç†

### ãƒ­ã‚°ã®å ´æ‰€
- **çµåˆãƒ­ã‚°**: `./logs/combined.log`
- **æ¨™æº–å‡ºåŠ›**: `./logs/out.log`
- **ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°**: `./logs/error.log`

### ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
```bash
# PM2-logrotateã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pm2 install pm2-logrotate

# è¨­å®š
pm2 set pm2-logrotate:max_size 10M
pm2 set pm2-logrotate:retain 30
pm2 set pm2-logrotate:compress true
```

## ğŸ”§ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆecosystem.config.jsï¼‰

ä¸»è¦ãªè¨­å®šé …ç›®ï¼š
- **instances**: 1ï¼ˆå˜ä¸€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼‰
- **autorestart**: trueï¼ˆè‡ªå‹•å†èµ·å‹•ï¼‰
- **max_memory_restart**: 1Gï¼ˆãƒ¡ãƒ¢ãƒªåˆ¶é™ï¼‰
- **max_restarts**: 10ï¼ˆæœ€å¤§å†èµ·å‹•å›æ•°ï¼‰
- **min_uptime**: 10sï¼ˆæœ€å°ç¨¼åƒæ™‚é–“ï¼‰

## âš ï¸ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Bot ãŒèµ·å‹•ã—ãªã„å ´åˆ
```bash
# ãƒ­ã‚°ã‚’ç¢ºèª
npm run pm2:logs

# æ‰‹å‹•ãƒ“ãƒ«ãƒ‰
npm run build

# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯
pm2 show discord-github-bot
```

### ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãŒå¤šã„å ´åˆ
```bash
# ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚’ç¢ºèª
pm2 monit

# åˆ¶é™å€¤ã‚’èª¿æ•´ï¼ˆecosystem.config.jsï¼‰
max_memory_restart: '512M'
```

### ç’°å¢ƒå¤‰æ•°ãŒèª­ã¿è¾¼ã¾ã‚Œãªã„å ´åˆ
```bash
# .envãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€ã‚’ç¢ºèª
ls -la .env

# æ‰‹å‹•ã§ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
pm2 set discord-github-bot:NODE_ENV production
```

## ğŸš€ æœ¬ç•ªé‹ç”¨ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

1. **å®šæœŸçš„ãªãƒ­ã‚°ç¢ºèª**
   ```bash
   npm run pm2:logs
   ```

2. **ã‚·ã‚¹ãƒ†ãƒ ç›£è¦–**
   ```bash
   pm2 monit
   ```

3. **å®šæœŸçš„ãªå†èµ·å‹•**ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
   ```bash
   # æ¯æ—¥æ·±å¤œ2æ™‚ã«å†èµ·å‹•ï¼ˆcrontabä¾‹ï¼‰
   0 2 * * * /usr/local/bin/pm2 restart discord-github-bot
   ```

4. **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**
   - `.env` ãƒ•ã‚¡ã‚¤ãƒ«
   - `data/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼‰
   - ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«

## ğŸ’¡ ãã®ä»–ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³

### systemdï¼ˆLinuxï¼‰
- ã‚·ã‚¹ãƒ†ãƒ ã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦ç™»éŒ²
- ã‚ˆã‚Šé«˜ã„å®‰å®šæ€§

### Docker
- ã‚³ãƒ³ãƒ†ãƒŠåŒ–ã«ã‚ˆã‚‹åˆ†é›¢
- ç’°å¢ƒã®ä¸€è²«æ€§

### ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹
- Heroku
- Railway
- Render
- DigitalOcean

PM2ãŒæœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã§åŠ¹æœçš„ãªè§£æ±ºç­–ã§ã™ï¼